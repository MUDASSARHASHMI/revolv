{% extends "base/base.html" %}
{% load staticfiles %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static "dashboard.css" %}" />
    <link rel="stylesheet" type="text/css" href="{% static "project.css" %}">
    <style type="text/css">
        #map-canvas { width: 500px; height: 300px; margin: 0; padding: 0;}
        #map-canvas img {max-width: none;}
    </style>
{% endblock %}

{% block title %}Project{% endblock %}

{% block body %}

{% include "project/partials/payment_modal.html" with form=form %}


<div class="row">
    <div class='row'>
        <dl class="tabs">
            <dd class="active tab-item"><a href="#simple1">Story</a></dd>
            <dd class="tab-item"><a href="#simple2">Updates</a></dd>
            <dd class="hide-for-small tab-item"><a href="#simple3">Gallery</a></dd>
        </dl>
        <ul class="tabs-content">
            <li class="active tab" id="simple1"> <div class="row">
            <div class="large-3 push-9 columns" id="impact-and-donate">
                <!-- <p>other thing</p> -->
                <div class='large-12 columns' id="donate-or-admin-panel-container">
                    <!-- <p> hi the donate box goes here</p> -->
                    <div id="donate-box">
                        <h5><strong>${{ project.amount_donated }}</strong> donated</h5>
                        <p>of ${{ project.funding_goal }}</p>
                        <div id="progress-bar"></div>
                        <p>Help us reach our goal!</p>
                        <div id="donate-button"><a href="#donate" data-reveal-id="donate-modal">Donate</a></div>
                    </div>
                </div>
                <div class="large-12 columns" id="impact-stats">
                    <div id="impact-box">
                        <h5>Impact</h5>
                        <p>of {{ project.funding_goal }}</p>
                        <p>impact information</p>
                        <p>impact information</p>
                        <p>impact information<p>
                    </div>
                </div>
            </div>
            <div class="large-9 pull-3 columns" id="main-project-info">
                {% if project.video_url %}
                    <iframe width="700" height="400" id="project_video">
                    </iframe>
                {% endif %}

                <h3>{{ project.title }}</h3>
                <p>Funding Goal: {{ project.funding_goal }}</p>
                <p>End Date: {{ project.end_date }}</p>
                <p>Location: {{ project.location}}</p>
                <p>Organization : {{project.org_name}}</p>
                <p>About {{project.org_name}} : {{project.org_about}}</p>
                <p>Mission Statement : {{ project.mission_statement }}</p>
            </div> 
            </li>
            <li class="tab" id="simple2">Updates go here</li>
            <li class="tab" id="simple3">Photo gallery!</li>
        </ul>
    </div>
</div>
<!-- <div class="row">
    <div class="large-12 columns">
        <h1><strong>{{ project.title }}</strong></h1>
        <ul class="button-group nav-tab-button-group">
            {% if project.is_active %}
            <li><a class="small button success radius" href="#donate" data-reveal-id="donate-modal">Donate</a></li>
            {% endif %}
        </ul>
        <h3>Funding Goal : {{ project.funding_goal }}</h3>
        <h3>End Date : {{ project.end_date }}</h3>
        <h5>Location : {{ project.location}}</h5>
        <div id="map-canvas"></div>
        <p>Organization : {{project.org_name}}</p>
        <p>About {{project.org_name}} : {{project.org_about}}</p>
        <img src="{{project.cover_photo.url}}"></img>
        <p>Mission Statement : {{ project.mission_statement }}</p>
        {% if project.video_url %}
        <iframe width="420" height="315" id="project_video">
		</iframe>
        {% endif %}
        {% if project.is_completed or project.is_active and project.post_funding_updates %}
        <h5>Post Funding Updates</h5>
        <p>{{ project.post_funding_updates}}</p>
        {% endif %}
    </div>
</div> -->

{% endblock %}



{% block javascripts %}
<script type="text/javascript" src="{% static "js/base/dashboard.js" %}"></script>

<script type="text/javascript"
    src="https://maps.googleapis.com/maps/api/js?key={{GOOGLEMAPS_API_KEY}}">
</script>

<script type="text/javascript" src="{% static "js/base/project.js" %}"></script>

{% if project.video_url %}
<script type="text/javascript">
// function to extract the associated iframe embed url from the video url
// from http://stackoverflow.com/questions/21607808/convert-a-youtube-video-url-to-embed-code
function getEmbedUrl(url) {
    var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
    var match = url.match(regExp);

    if (match && match[2].length == 11) {
        var video_id = match[2];
        return "http://www.youtube.com/embed/" + video_id;
    } else {
        return "error";
    }
}

// updates the iframe src url if youtube url is valid, otherwise hides it
var embedUrl = getEmbedUrl("{{project.video_url}}");
if (embedUrl === "error") {
    $("#project_video").remove();
} else {
    $("#project_video").attr("src", embedUrl);
}
</script>
{% endif %}

<script type="text/javascript">
    // initializes the map based on the projects latitude and longitude, and adds the marker
    function initialize() {
        var location = { lat: {{project.location_latitude}}, lng: {{project.location_longitude}} }
        var mapOptions = {
            center: location,
            zoom: 18
        };
        var map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);
        var marker = new google.maps.Marker({
            position: location,
            map: map,
        });
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>
{% endblock %}
