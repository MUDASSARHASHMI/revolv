{% extends "base/base.html" %}
{% load staticfiles %}
{% load humanize %}

{% block title %}What We Do | {% endblock %}

{% block head %}

    <link rel="stylesheet" type="text/css" href="{% static "projects-list.css" %}">

    <script type="text/javascript" src="{% static "js/vendor/jquery.min.js" %}"></script>
    <script type="text/javascript" src="{% static "js/vendor/d3.min.js" %}"></script>
    <script type="text/javascript" src="{% static "js/base/util/util.js" %}"></script>
    <script type="text/javascript" src="{% static "js/base/partialcircle.js" %}"></script>
    <script type="text/javascript" src="{% static "js/base/projects-list.js" %}"></script>

{% endblock %}

{% block javascripts %}

    <script type="text/javascript" src="{% static "js/vendor/skrollr.min.js" %}"></script>
    <script type="text/javascript" src="{% static "js/vendor/skrollr.menu.min.js" %}"></script>
    <script type="text/javascript">
        var s = skrollr.init();

        skrollr.menu.init(s, {
            animate: true,
            easing: 'sqrt'
        });
    </script>
{% endblock %}

{% block body %}
    {% spaceless %}
        {% if is_reinvestment %}
            {% if error_msg %}
                <div class="divider-title "><h5>{{ error_msg }}</h5></div>
            {% else %}
                <div class="divider-title ">You have ${{ reinvestment_amount }} to reinvest. Pick a project below to back!</div>
            {% endif %}
        {% else %}
            {% if active_projects|length == 1%}
                <div class="divider-title ">{{ settings.revolv_cms.ActiveProjectsPageSettings.single_project_heading}}</div>
            {% elif active_projects|length > 1 %}
                <div class="divider-title">{{ settings.revolv_cms.ActiveProjectsPageSettings.multiple_projects_heading}}</div>
            {% endif %}
        {% endif %}
            {% if not error_msg %}
        <div class="row active-projects-block">
            {% for active_project in active_projects %}
                {% if active_project.cover_photo %}
                    <div class="active-project {% if forloop.counter|divisibleby:3 %}last-active-project-in-row{% endif %}" >

                        <a href="{% url "project:view" pk=active_project.pk %}">
                            <div class="overlay">

                                <div class="active-project-cover" style="background-image: url({{active_project.cover_photo.url}})">

                                    <div class="active-project-inset">
                                        <h3 class="heading-top-margin">{{ active_project.title }}</h3>
                                    </div>
                                    <div class="graphics-container">
                                        <span class="partial-completeness">{{ active_project.partial_completeness_as_js }}</span>
                                        <svg class="svg-graphics-container"></svg>
                                        <svg class="internal-graphics-container"></svg>
                                        <div class="text-container">
                                            <p class="percentage-text">{{ active_project.percent_complete }}%</p>
                                            <p class="funded">FUNDED</p>
                                        </div>
                                    </div>

                                </div>
                                <div class="statistics-graphics-container">
                                    <div class="bar top-bar">
                                        <div class="container">
                                            <p class="left-text statistic amount-donated">${{ active_project.amount_donated }} donated</p>
                                            <p class="right-text statistic days-left">{{ active_project.days_left }} days left</p>
                                        </div>
                                    </div>
                                    <div class="bar bottom-bar">
                                        <div class="container">
                                            <p class ="left-text statistic amount-saved">{{ active_project.actual_energy }} kwH saved</p>
                                            <p class ="right-text statistic num-donors">{{ active_project.donors.count }} {{ settings.revolv_cms.ProjectPageSettings.donors_wording }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}
        <div class="row about">
            <div class="about-inset">
                <!-- Call to action -->
                {% if not is_reinvestment %}
                <h2>{{ settings.revolv_cms.ActiveProjectsPageSettings.join_the_movement }}</h2>
                <a href="{% url "project:new" %}" class="donate button">{{ settings.revolv_cms.ActiveProjectsPageSettings.start_funding_button_text }}</a>
                {% endif %}
            </div>
        </div>
    {% endspaceless %}
{% endblock %}
